<!doctype html>
<html lang="es">
<meta charset="utf-8" />
<title>Demo fácil: validar + sanitizar</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body{font-family:system-ui,Arial,sans-serif;max-width:720px;margin:24px auto;padding:0 16px}
  input,textarea,button{width:100%;padding:10px;margin:6px 0;border:1px solid #ccc;border-radius:8px}
  input:invalid,textarea:invalid{border-color:#d33}
  pre{background:#f7f7f7;padding:12px;border-radius:8px;white-space:pre-wrap;word-break:break-word}
  .ok{color:#155724;background:#d4edda;border:1px solid #c3e6cb;padding:8px;border-radius:8px}
  .bad{color:#721c24;background:#f8d7da;border:1px solid #f5c6cb;padding:8px;border-radius:8px}
</style>

<h1>Validación + Sanitización (ultra simple)</h1>

<form id="f" novalidate>
  <label>Correo</label>
  <input id="email" type="email" required placeholder="tu@correo.com">

  <label>Nombre (solo letras y espacios, 2–60)</label>
  <input id="name" required pattern="^[A-Za-zÁ-Úá-úÑñ ]{2,60}$" placeholder="Ej. Juan Pérez">

  <label>Mensaje (máx. 300)</label>
  <textarea id="msg" maxlength="300" rows="4" placeholder="Escribe tu mensaje..."></textarea>

  <div id="status"></div>
  <button>Previsualizar</button>
</form>

<h2>Vista previa segura</h2>
<pre id="out">(sin datos)</pre>

<script>
  const E = s => String(s)
    .replace(/&/g,"&amp;").replace(/</g,"&lt;")
    .replace(/>/g,"&gt;").replace(/"/g,"&quot;")
    .replace(/'/g,"&#39;"); // escape básico contra XSS

  const clean = s => String(s).trim()
    .replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi,"") // quita <script>
    .replace(/<\/?[^>]+>/g,"")                         // quita etiquetas
    .replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"");  // control chars

  f.onsubmit = (e) => {
    e.preventDefault();
    if (!f.checkValidity()){
      status.innerHTML = '<div class="bad">Revisa los campos en rojo.</div>';
      return;
    }
    const email = clean(email.value).slice(0,100);
    const name  = clean(name.value).slice(0,60);
    const msg   = clean(msg.value).slice(0,300);

    // bloqueo muy básico de inyección (demo)
    if (/\b(select|insert|update|delete|drop|union|--|#|;)\b/i.test(msg)) {
      status.innerHTML = '<div class="bad">Patrón no permitido en el mensaje.</div>';
      return;
    }

    status.innerHTML = '<div class="ok">Validado y sanitizado.</div>';
    out.textContent = `Correo: ${E(email)}\nNombre: ${E(name)}\nMensaje:\n${E(msg)}`;
  };
</script>
</html>
